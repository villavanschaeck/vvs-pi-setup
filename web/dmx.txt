# Add admins
adduser --gid 100 --shell /bin/bash --gecos "Pol van Aubel,,," --disabled-password pol
usermod -p "$USER_POL_PASSWORD" pol
adduser pol sudo
mkdir /home/pol/.ssh
chown pol:100 /home/pol/.ssh
chmod 700 /home/pol/.ssh
wget -O /home/pol/.ssh/.authorized_keys http://$DHCP_NEXT_SERVER/$DHCP_NEXT_SERVER_PATH/pol-authorized_keys.txt
chown pol:100 /home/pol/.ssh/authorized_keys

adduser --gid 100 --shell /bin/bash --gecos "Bart Schuurmans,,," --disabled-password barts
usermod -p "$USER_BARTS_PASSWORD" barts
adduser barts sudo

# Add user
adduser --uid 500 --disabled-password --home /home/schaeckeling/ --gecos "Schaeckeling user,,," schaeckeling
adduser schaeckeling plugdev

# Configure system
cat <<EOF > /etc/udev/rules.d/50-enttec.rules
SUBSYSTEM=="usb*", ACTION=="add|change", ATTRS{idVendor}=="0403", ATTRS{idProduct}=="6001", MODE="0664", GROUP="plugdev"
EOF

cat <<EOF > /etc/udev/rules.d/50-korg.rules
SUBSYSTEM=="usb*", ACTION=="add|change", ATTRS{idVendor}=="0944", ATTRS{idProduct}=="0117", MODE="0664", GROUP="plugdev"
EOF

cat <<EOF > /etc/modprobe.d/mk2pro.conf
blacklist ftdi_sio
blacklist usbserial
EOF

# Install libraries
apt-get install -y libftdi-dev

# Install our software
cd /home/schaeckeling/
git clone git://github.com/villavanschaeck/schaeckeling.git
wget -O /home/schaeckeling/schaeckeling/src/api_key.h "$DMX_API_KEY_H_URL"
wget -O /home/schaeckeling/schaeckeling/src/config.dat http://$DHCP_NEXT_SERVER/$DHCP_NEXT_SERVER_PATH/dmx-config-kelder.dat
make -C /home/schaeckeling/schaeckeling/src

wget -O /etc/init.d/dmxd http://$DHCP_NEXT_SERVER/$DHCP_NEXT_SERVER_PATH/dmx-initscript.txt
chmod 755 /etc/init.d/dmxd
update-rc.d dmxd defaults
